{% extends 'webapp/base.html' %}

{% block content %}
    <h3>Welcome to Cleaner Dashboard, User {{ user }}</h3>
    <hr>

    <div class="mt-4">
        <h4>My Listings</h4>
        {% if listing_data %}
        <div class="list-group">
            {% for data in listing_data %}
                <div class="list-group-item d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <h5>{{ data.listing.name }}</h5>
                        <p class="mb-1">
                        Status:
                        {% if data.listing.status|lower == 'open' %}
                            <span class="badge bg-success">{{ data.listing.status|capfirst }}</span>
                            {% else %}
                            <span class="badge bg-secondary">{{ data.listing.status|capfirst }}</span>
                        {% endif %}
                        </p>
                    </div>
                    <a href="{% url 'cleaning_listing_view' data.listing.id %}" class="btn btn-primary">View Details</a>
                </div>
                {% if data.requests %}
                <table class="table mt-3 table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>Request Date</th>
                            <th>Requested By</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for request in data.requests %}
                        <tr>
                            <td>{{ request.request_date }}</td>
                            <td>{{ request.property.homeowner.full_name }}</td>
                            <td>{{ request.status }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="mt-2 text-muted">No cleaning requests yet.</p>
                {% endif %}
                <br>
            {% endfor %}
        </div>
        {% else %}
        <p>No listings available.</p>
        {% endif %}
    </div>
{% endblock %}
